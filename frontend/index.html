<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futuristic AI Support</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h2>AI Support Assistant</h2>
            <span>Online</span>
        </div>
        <div class="chat-box" id="chat-box">
            <div class="message bot-message">
                <p>Hello! I am your AI assistant. How can I help you today?</p>
            </div>
        </div>
        <div class="chat-input">
            <input type="text" id="user-input" placeholder="Ask me anything...">
            <button id="send-btn">
                <svg viewBox="0 0 24 24" >
                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                </svg>
            </button>
        </div>
    </div>

    <script>
        let sessionId = null;
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');

        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') sendMessage(); });

        function addMessageToChatbox(sender, message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', `${sender}-message`);
            const p = document.createElement('p');
            p.textContent = message;
            messageElement.appendChild(p);
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        async function sendMessage() {
            const messageText = userInput.value.trim();
            if (!messageText) return;

            addMessageToChatbox('user', messageText);
            userInput.value = '';
            setBotTyping(true);

            try {
                // IMPORTANT: This URL points to your local Flask backend.
                // When you deploy, change this to your live Render URL.
                const response = await fetch('http://127.0.0.1:5000/chat', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        session_id: sessionId,
                        message: messageText,
                    }),
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const data = await response.json();
                sessionId = data.session_id; // Store the session ID from the first response

                setBotTyping(false);
                addMessageToChatbox('bot', data.response);

            } catch (error) {
                setBotTyping(false);
                addMessageToChatbox('bot', `Sorry, something went wrong. Error: ${error.message}`);
            }
        }

        function setBotTyping(isTyping) {
            let typingIndicator = document.getElementById('typing-indicator');
            if (isTyping && !typingIndicator) {
                typingIndicator = document.createElement('div');
                typingIndicator.id = 'typing-indicator';
                typingIndicator.classList.add('message', 'bot-message');
                typingIndicator.innerHTML = `<div class="typing-dots"><span></span><span></span><span></span></div>`;
                chatBox.appendChild(typingIndicator);
                chatBox.scrollTop = chatBox.scrollHeight;

                const style = document.createElement('style');
                style.innerHTML = `
                    .typing-dots span { height: 8px; width: 8px; background-color: #d1d5db; border-radius: 50%; display: inline-block; animation: bounce 1.4s infinite ease-in-out both; }
                    .typing-dots span:nth-of-type(1) { animation-delay: -0.32s; }
                    .typing-dots span:nth-of-type(2) { animation-delay: -0.16s; }
                    @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
                `;
                document.head.appendChild(style);
            } else if (!isTyping && typingIndicator) {
                typingIndicator.remove();
            }
        }
    </script>
</body>
</html>